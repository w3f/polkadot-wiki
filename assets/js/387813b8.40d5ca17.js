(self.webpackChunk=self.webpackChunk||[]).push([[660],{47940:(e,a,t)=>{"use strict";t.d(a,{Z:()=>h});var r=t(74165),n=t(15861),o=t(67294),i=t(87152),s=t(9712),l=t(67425);function c(e,a,t){return p.apply(this,arguments)}function p(){return(p=(0,n.Z)((0,r.Z)().mark((function e(a,t,n){var o,l,c,p,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=void 0,l=void 0,e.t0=a,e.next="polkadot"===e.t0?5:"kusama"===e.t0?7:"statemine"===e.t0?9:"statemint"===e.t0?11:13;break;case 5:return o="wss://rpc.polkadot.io",e.abrupt("break",14);case 7:return o="wss://kusama-rpc.polkadot.io/",e.abrupt("break",14);case 9:return o="wss://statemine-rpc.polkadot.io/",e.abrupt("break",14);case 11:return o="wss://statemint-rpc.polkadot.io/",e.abrupt("break",14);case 13:console.log("Unknown socket url provided, no connection made.");case 14:if(void 0!==o){e.next=18;break}return e.abrupt("return");case 18:return c=new i.U(o),e.next=21,s.G.create({provider:c});case 21:p=e.sent,(d=t.split(".")).forEach((function(e){e in p&&(p=p[e])})),e.t1=d[0],e.next="consts"===e.t1?27:"query"===e.t1?29:34;break;case 27:return l=p.toString(),e.abrupt("break",35);case 29:return e.next=31,p();case 31:return l=(l=e.sent).toString(),e.abrupt("break",35);case 34:console.log("Unknown path prefix ("+d[0]+") in "+t);case 35:return e.abrupt("return",l);case 36:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e,a,t,r){switch(a){case"humanReadable":(0,l.HumanReadable)(e,t,r);break;case"precise":(0,l.Precise)(e,t,r);break;case"blocksToDays":(0,l.BlocksToDays)(e,r);break;case"erasToDays":(0,l.ErasToDays)(e,r,t);break;case"percentage":(0,l.Percentage)(e,r);break;case"permillToPercent":(0,l.PermillToPercent)(e,r);break;case"arrayLength":(0,l.ArrayLength)(e,r);break;default:return void console.log("Ignoring unknown filter type")}}const h=function(e){var a=e.network,t=e.path,i=e.defaultValue,s=e.filter,l=void 0===s?void 0:s,p=(0,o.useState)(""),h=p[0],m=p[1];return a=a.toLowerCase(),(0,o.useEffect)((function(){void 0!==l?d(i.toString(),l,a,m):m(i.toString());var e=void 0;switch(a){case"polkadot":e="wss://rpc.polkadot.io";break;case"kusama":e="wss://kusama-rpc.polkadot.io/";break;case"statemine":e="wss://kusama-asset-hub-rpc.polkadot.io/";break;case"statemint":e="wss://polkadot-asset-hub-rpc.polkadot.io/";break;case"kusama-people":e="wss://kusama-people-rpc.polkadot.io";break;default:console.log("Unknown network provided, "+a)}if(void 0===e)console.log("Failed to connect to a valid websocket, applying default");else{var o=function(){var e=(0,n.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(a,t,m);case 2:if(void 0!==(n=e.sent)){e.next=7;break}return e.abrupt("return");case 7:void 0!==l?d(n,l,a,m):m(n);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();try{o()}catch(s){console.log(s)}}}),[]),h}},67425:e=>{var a="polkadot",t="kusama",r="statemine",n="statemint",o={polkadot:{precision:1e10,symbol:"DOT"},kusama:{precision:1e12,symbol:"KSM"},statemint:{precision:1e10,symbol:"DOT"},statemine:{precision:1e12,symbol:"KSM"}};e.exports={HumanReadable:function(e,i,s){var l=void 0;if(i===a||i===n)l=3;else{if(i!==t&&i!==r)return void console.log("Unknown network type found when attempting to apply 'Human Readable' filter");l=6}e=parseFloat(e),s((e=Number.isInteger(e/o[i].precision)?e/o[i].precision+" "+o[i].symbol:(e/o[i].precision).toFixed(l)+" "+o[i].symbol).toString())},Precise:function(e,a,t){t(e=(e=parseFloat(e))/o[a].precision+" "+o[a].symbol)},BlocksToDays:function(e,a){a((e=6*e/86400).toString())},ErasToDays:function(e,o,i){var s=void 0;if(i===a||i===n)s=1;else{if(i!==t&&i!==r)return void console.log("Unknown network type found when attempting to apply 'Human Readable' filter");s=4}o((e/=s).toString())},Percentage:function(e,a){a((e/=1e7).toString())},PermillToPercent:function(e,a){a((e/=1e4).toString())},ArrayLength:function(e,a){a((e=e.split(",").length).toString())}}},93487:(e,a,t)=>{"use strict";t.r(a),t.d(a,{assets:()=>d,contentTitle:()=>c,default:()=>k,frontMatter:()=>l,metadata:()=>p,toc:()=>h});var r=t(87462),n=t(63366),o=(t(67294),t(3905)),i=t(47940),s=["components"],l={id:"learn-guides-coretime-parachains",title:"Agile Coretime for Parachains",sidebar_label:"Coretime for Parachains",description:"Agile Coretime from Parachains perspective",keywords:["coretime","blockspace","parathread","parachain","cores"],slug:"../learn-guides-coretime-parachains"},c=void 0,p={unversionedId:"learn/learn-guides-coretime-parachains",id:"learn/learn-guides-coretime-parachains",title:"Agile Coretime for Parachains",description:"Agile Coretime from Parachains perspective",source:"@site/../docs/learn/learn-guides-coretime-parachains.md",sourceDirName:"learn",slug:"/learn-guides-coretime-parachains",permalink:"/docs/learn-guides-coretime-parachains",draft:!1,editUrl:"https://github.com/w3f/polkadot-wiki/edit/master/docs/learn/learn-guides-coretime-parachains.md",tags:[],version:"current",lastUpdatedBy:"bader y",lastUpdatedAt:1713586407,formattedLastUpdatedAt:"Apr 20, 2024",frontMatter:{id:"learn-guides-coretime-parachains",title:"Agile Coretime for Parachains",sidebar_label:"Coretime for Parachains",description:"Agile Coretime from Parachains perspective",keywords:["coretime","blockspace","parathread","parachain","cores"],slug:"../learn-guides-coretime-parachains"},sidebar:"docs",previous:{title:"Coretime Marketplaces",permalink:"/docs/learn-guides-coretime-marketplaces"},next:{title:"Bridges",permalink:"/docs/learn-bridges"}},d={},h=[{value:"Reserve ParaID",id:"reserve-paraid",level:2},{value:"Register Parachain State and Code",id:"register-parachain-state-and-code",level:2},{value:"Run Parachain Collator",id:"run-parachain-collator",level:2},{value:"Run a Parachain with Bulk Coretime",id:"run-a-parachain-with-bulk-coretime",level:2},{value:"Run a Parachain with On-demand Coretime",id:"run-a-parachain-with-on-demand-coretime",level:2}],m={toc:h},u="wrapper";function k(e){var a=e.components,l=(0,n.Z)(e,s);return(0,o.kt)(u,(0,r.Z)({},m,l,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"If you aren't sure what Agile Coretime is, be sure to read the\n",(0,o.kt)("a",{parentName:"p",href:"/docs/learn-agile-coretime"},"introduction"),",\n",(0,o.kt)("a",{parentName:"p",href:"/docs/learn-agile-coretime#agile-coretime-terminology"},"terminology"),", and\n",(0,o.kt)("a",{parentName:"p",href:"/docs/learn-agile-coretime#agile-coretime-faq"},"FAQ"),".")),(0,o.kt)("p",null,"The landscape for parachains on Polkadot\nchanges with the rollout of ",(0,o.kt)("a",{parentName:"p",href:"/docs/learn-agile-coretime"},"Agile Coretime"),". With\n",(0,o.kt)("a",{parentName:"p",href:"/docs/learn-auction"},"parachain auctions")," being phased out in favor of direct\n",(0,o.kt)("a",{parentName:"p",href:"/docs/learn-agile-coretime#coretime"},"coretime")," sales, the existing parachains on the relaychain and\nthe prospective parachains are presented with the following scenarios:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Migrating")," from a legacy parachain lease into a\n",(0,o.kt)("a",{parentName:"li",href:"/docs/learn-agile-coretime#bulk-coretime"},"bulk coretime")," model"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Starting")," with bulk coretime model from scratch"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Running"),' a parachain with on-demand coretime purchases ("pay as you go")')),(0,o.kt)("p",null,"The parachain lease auctions will stop on-chain with the enactment of the\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/polkadot-fellows/runtimes/releases/tag/v1.2.0"},"runtime upgrade 1.2.0"),", and the\nexisting leases will be migrated to bulk coretime automatically. Leases that are yet to be started\nwill be canceled and the locked DOT",(0,o.kt)("br",{parentName:"p"}),"\n","will be refunded. The existing parachains benefit from\n",(0,o.kt)("a",{parentName:"p",href:"https://docs.lastic.xyz/coretime/renewals.html"},"coretime renewals")," which allows for the continued\nassignment of bulk coretime for a core without going through the regular purchasing process."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"The tutorials below assume that you have already developed the parachain runtime and a fully\nconfigured parachain ",(0,o.kt)("a",{parentName:"p",href:"/docs/learn-collator"},"collator")," for the target relay chain using the Polkadot\nSDK.")),(0,o.kt)("p",null,"For the tutorials below,\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/paritytech/polkadot-sdk/tree/6f3d890ed35bfdee3e3f7d59018345635a62d1cd/polkadot/parachain/test-parachains/adder"},"the adder test parachain"),"\non the Polkadot SDK has been used. To compile the ",(0,o.kt)("inlineCode",{parentName:"p"},"adder-collator"),", run the command below in the\n",(0,o.kt)("em",{parentName:"p"},"root")," of the Polkadot SDK repository. You must have ",(0,o.kt)("a",{parentName:"p",href:"https://www.rust-lang.org/tools/install"},"Rust"),"\nand its associated tooling installed before following along."),(0,o.kt)("p",null,"Ensure the Polkadot SDK is cloned, and you are within the root directory (",(0,o.kt)("inlineCode",{parentName:"p"},"cd polkadot-sdk"),")"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"cargo build -r -p test-parachain-adder-collator\n")),(0,o.kt)("p",null,"After the test parachain collator node is successfully compiled, export its genesis state and the\ncode using the following commands. If the export succeeds, these two files should appear in the\nPolkadot-SDK repository."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"./target/release/adder-collator export-genesis-state genesis\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"./target/release/adder-collator export-genesis-wasm genesis-wasm\n")),(0,o.kt)("h2",{id:"reserve-paraid"},"Reserve ParaID"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Reserving a ",(0,o.kt)("inlineCode",{parentName:"p"},"ParaID")," requires a deposit of:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)(i.Z,{network:"kusama",path:"consts.registrar.paraDeposit",defaultValue:0,filter:"humanReadable",mdxType:"RPC"})," on Kusama")),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)(i.Z,{network:"polkadot",path:"consts.registrar.paraDeposit",defaultValue:0,filter:"humanReadable",mdxType:"RPC"})," on Polkadot"))),(0,o.kt)("p",null,"The first step is to register a ",(0,o.kt)("a",{parentName:"p",href:"/docs/glossary#paraid"},(0,o.kt)("inlineCode",{parentName:"a"},"ParaID"))," for the parachain. This\ncan be done through Polkadot-JS UI by navigating to\n",(0,o.kt)("a",{parentName:"p",href:"https://polkadot.js.org/apps/#/parachains/parathreads"},"Network > Parachains > Parathreads")," and\nclicking on ParaID button. Ensure that you have sufficient tokens to reserve the displayed ",(0,o.kt)("inlineCode",{parentName:"p"},"ParaID"),"\nsuccessfully."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"coretime-reserve-paraID",src:t(56770).Z,width:"2161",height:"713"})),(0,o.kt)("h2",{id:"register-parachain-state-and-code"},"Register Parachain State and Code"),(0,o.kt)("p",null,"The next step is to register the parachain's genesis wasm and state, which you should have generated\nearlier. Note that for this example, we are using ",(0,o.kt)("inlineCode",{parentName:"p"},"adder-collator"),", but in theory a custom runtime\ncompiled from a\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/paritytech/polkadot-sdk/tree/88a2f360238787bf5256cfdd14b40c08f519b38e/templates/parachain"},"template"),"\nwould work as well."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Registering the genesis state and WASM code of the parachain requires a deposit that is computed\nbased on the size (a deposit is paid per byte uploaded):"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Kusama"),": ",(0,o.kt)(i.Z,{network:"kusama",path:"consts.registrar.dataDepositPerByte",defaultValue:0,filter:"humanReadable",mdxType:"RPC"})," per byte")),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Polkadot"),": ",(0,o.kt)(i.Z,{network:"polkadot",path:"consts.registrar.dataDepositPerByte",defaultValue:0,filter:"humanReadable",mdxType:"RPC"})," per byte")),(0,o.kt)("p",{parentName:"admonition"},"The deposit used for registering ",(0,o.kt)("inlineCode",{parentName:"p"},"ParaID")," is already counted in for this deposit, the total deposit\nrequirement for registering ",(0,o.kt)("inlineCode",{parentName:"p"},"ParaID"),", state and code for ",(0,o.kt)("inlineCode",{parentName:"p"},"adder-collator")," is around 46 KSM on Kusama\nand 116 DOT on Polkadot.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"coretime-register-parathread",src:t(13670).Z,width:"2136",height:"977"})),(0,o.kt)("p",null,"After successful registration, the parachain starts onboarding as a parathread."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"coretime-onboarding-parathread",src:t(83177).Z,width:"2873",height:"352"})),(0,o.kt)("h2",{id:"run-parachain-collator"},"Run Parachain Collator"),(0,o.kt)("p",null,"While the parachain is onboarding, start syncing the ",(0,o.kt)("a",{parentName:"p",href:"/docs/learn-collator"},"collator")," using the\nfollowing command to rapidly sync with the specified relay chain."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./target/release/adder-collator --parachain-id= $ParaID --chain=rococo --sync fast-unsafe\n")),(0,o.kt)("h2",{id:"run-a-parachain-with-bulk-coretime"},"Run a Parachain with Bulk Coretime"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Note that we have two options: ",(0,o.kt)("strong",{parentName:"p"},"bulk coretime")," and ",(0,o.kt)("strong",{parentName:"p"},"on-demand coretime"),". Bulk coretime is\npurchased via the ",(0,o.kt)("inlineCode",{parentName:"p"},"broker")," pallet, which is on the respective Coretime system parachain. On-demand\ncoretime is ordered via the ",(0,o.kt)("inlineCode",{parentName:"p"},"OnDemandAssignment")," pallet/module, which is located on the respective\nrelay chain.")),(0,o.kt)("p",null,"You can purchase bulk coretime on ",(0,o.kt)("a",{parentName:"p",href:"/docs/learn-guides-coretime-marketplaces"},"Coretime chain")," and\nassign the purchased core to the registered ",(0,o.kt)("inlineCode",{parentName:"p"},"ParaID"),". The snapshot below is from\n",(0,o.kt)("a",{parentName:"p",href:"https://test.lastic.xyz/"},"Lastic")," interface."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"coretime-bulk-assign-lastic",src:t(17765).Z,width:"1322",height:"1033"})),(0,o.kt)("p",null,"After successful assignment of the core, the ",(0,o.kt)("inlineCode",{parentName:"p"},"adder-collator")," logs show new collations at regular\nintervals, gradually incrementing the state by ",(0,o.kt)("inlineCode",{parentName:"p"},"2"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"coretime-collation-bulk",src:t(49799).Z,width:"1777",height:"696"})),(0,o.kt)("h2",{id:"run-a-parachain-with-on-demand-coretime"},"Run a Parachain with On-demand Coretime"),(0,o.kt)("p",null,"After the collator node is fully synced with the relay chain, navigate to\n",(0,o.kt)("a",{parentName:"p",href:"https://polkadot.js.org/apps/#/extrinsics"},"Developer > Extrinsics")," on the relay chain and issue\n",(0,o.kt)("inlineCode",{parentName:"p"},"onDemandAssignmentProvider.placeOrderAllowDeath")," extrinsic from the account that registered the\n",(0,o.kt)("inlineCode",{parentName:"p"},"ParaID")," by specifying sufficient ",(0,o.kt)("inlineCode",{parentName:"p"},"maxAmount"),"for the transaction to go through successfully."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"coretime-ondemand-assignment",src:t(11075).Z,width:"2873",height:"1394"})),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"There are two extrinsics which allow you to place orders for on-demand coretime:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"onDemandAssignmentProvider.placeOrderAllowDeath")," will\n",(0,o.kt)("a",{parentName:"p",href:"/docs/learn-accounts#existential-deposit-and-reaping"},"reap")," the account once the provided funds\nrun out.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"onDemandAssignmentProvider.placeOrderKeepAlive")," includes a check which will ",(0,o.kt)("strong",{parentName:"p"},"not")," reap the\naccount if the provided funds will run out, ensuring the account is kept alive.")))),(0,o.kt)("p",null,"With each successful on-demand extrinsic, the parachain head changes (you may have to zoom out on\nthe browser for parachain head details to show up on Polkadot-JS UI)."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"coretime-ondemand-parahead",src:t(8486).Z,width:"1435",height:"319"})),(0,o.kt)("p",null,"The successful collation can also be verified in the parachain collator logs. It can be noticed that\nwith each parachain block, the state of ",(0,o.kt)("inlineCode",{parentName:"p"},"adder-collator")," is incremented by ",(0,o.kt)("inlineCode",{parentName:"p"},"2"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"coretime-new-collation",src:t(70567).Z,width:"1782",height:"426"})))}k.isMDXComponent=!0},49799:(e,a,t)=>{"use strict";t.d(a,{Z:()=>r});const r=t.p+"assets/images/coretime-collation-bulk-d6f817e5970e0194d4d5a3dfe70959b7.png"},70567:(e,a,t)=>{"use strict";t.d(a,{Z:()=>r});const r=t.p+"assets/images/coretime-create-new-collation-7da7b7b28f77f12a731dc4d84baf2e38.png"},11075:(e,a,t)=>{"use strict";t.d(a,{Z:()=>r});const r=t.p+"assets/images/coretime-on-demand-assignment-098632f2c2246a688ffb1405c12e87b5.png"},8486:(e,a,t)=>{"use strict";t.d(a,{Z:()=>r});const r=t.p+"assets/images/coretime-on-demand-parahead-36a2079a7b6575851931724c54415a4d.png"},83177:(e,a,t)=>{"use strict";t.d(a,{Z:()=>r});const r=t.p+"assets/images/coretime-parachain-onboarding-9d96e69f180f0a932f526855ef990f73.png"},13670:(e,a,t)=>{"use strict";t.d(a,{Z:()=>r});const r=t.p+"assets/images/coretime-register-parathread-c49534aa188c71fcb462ba7ded9014ce.png"},56770:(e,a,t)=>{"use strict";t.d(a,{Z:()=>r});const r=t.p+"assets/images/coretime-reserve-paraID-59fe64fdbcc55e6029182070bf3d416d.png"},17765:(e,a,t)=>{"use strict";t.d(a,{Z:()=>r});const r=t.p+"assets/images/lastic-assign-core-bf4ebbb0f6bf5633a10a17c08f22cd79.png"},46601:()=>{}}]);