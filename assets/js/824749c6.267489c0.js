"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8800],{68498:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var a=t(74848),s=t(28453);const i={id:"build-node-interaction",title:"Node Interaction",sidebar_label:"Node Interaction",description:"Tools for node interaction.",keywords:["RPC","api","integration"],slug:"../build-node-interaction"},r=void 0,o={id:"build/build-node-interaction",title:"Node Interaction",description:"Tools for node interaction.",source:"@site/../docs/build/build-node-interaction.md",sourceDirName:"build",slug:"/build-node-interaction",permalink:"/docs/build-node-interaction",draft:!1,unlisted:!1,editUrl:"https://github.com/w3f/polkadot-wiki/edit/master/docs/build/build-node-interaction.md",tags:[],version:"current",lastUpdatedBy:"Keith Alfaro",lastUpdatedAt:166556615e4,frontMatter:{id:"build-node-interaction",title:"Node Interaction",sidebar_label:"Node Interaction",description:"Tools for node interaction.",keywords:["RPC","api","integration"],slug:"../build-node-interaction"},sidebar:"docs",previous:{title:"Using Light Clients",permalink:"/docs/build-light-clients"},next:{title:"Smart Contracts",permalink:"/docs/build-smart-contracts"}},c={},d=[{value:"Polkadot RPC",id:"polkadot-rpc",level:2},{value:"Tracking the Chain Head",id:"tracking-the-chain-head",level:3},{value:"Substrate API Sidecar",id:"substrate-api-sidecar",level:2},{value:"Fetching a Block",id:"fetching-a-block",level:3},{value:"Submitting a Transaction",id:"submitting-a-transaction",level:3}];function l(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["This page will guide you through some basic interactions with your node. This guide should ",(0,a.jsx)(n.em,{children:"guide\nyou to the proper tools,"})," not be seen as canonical reference. Always refer to the proper\ndocumentation for the tool you are using:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://paritytech.github.io/substrate/master/sc_rpc_api/index.html",children:"Substrate RPC API"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://polkadot.js.org/docs/substrate/rpc",children:"Polkadot-JS RPC"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/paritytech/substrate-api-sidecar",children:"Substrate API Sidecar"})}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Polkadot-JS RPC"})," is a JavaScript library for interacting with the ",(0,a.jsx)(n.strong,{children:"Substrate RPC API"})," endpoint,\ndistributed as ",(0,a.jsx)(n.code,{children:"@polkadot/api"})," Node.js package.",(0,a.jsx)(n.br,{}),"\n",(0,a.jsx)(n.strong,{children:"Substrate API Sidecar"})," is using the ",(0,a.jsx)(n.strong,{children:"Polkadot-JS RPC"})," to provide separately runnable REST\nservices."]}),"\n",(0,a.jsx)(n.h2,{id:"polkadot-rpc",children:"Polkadot RPC"}),"\n",(0,a.jsx)(n.p,{children:"The Parity Polkadot client exposes HTTP and WS endpoints for RPC connections. The default ports are\n9933 for HTTP and 9944 for WS."}),"\n",(0,a.jsxs)(n.p,{children:["To get a list of all RPC methods, the node has an RPC endpoint called ",(0,a.jsx)(n.code,{children:"rpc_methods"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["For example, using ",(0,a.jsx)(n.a,{href:"https://github.com/vi/websocat#installation",children:"websocat"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'echo \'{"id":1,"jsonrpc":"2.0","method":"rpc_methods","params":[]}\' | websocat -n1 -B 99999999 ws://127.0.0.1:9944\n\n{"jsonrpc":"2.0","result":{"methods":["account_nextIndex","author_hasKey","author_hasSessionKeys","author_insertKey","author_pendingExtrinsics","author_removeExtrinsic","author_rotateKeys","author_submitAndWatchExtrinsic","author_submitExtrinsic","author_unwatchExtrinsic","babe_epochAuthorship","beefy_getFinalizedHead","beefy_subscribeJustifications","beefy_unsubscribeJustifications","chain_getBlock","chain_getBlockHash","chain_getFinalisedHead","chain_getFinalizedHead","chain_getHead","chain_getHeader","chain_getRuntimeVersion","chain_subscribeAllHeads","chain_subscribeFinalisedHeads","chain_subscribeFinalizedHeads","chain_subscribeNewHead","chain_subscribeNewHeads","chain_subscribeRuntimeVersion","chain_unsubscribeAllHeads","chain_unsubscribeFinalisedHeads","chain_unsubscribeFinalizedHeads","chain_unsubscribeNewHead","chain_unsubscribeNewHeads","chain_unsubscribeRuntimeVersion","childstate_getKeys","childstate_getKeysPaged","childstate_getKeysPagedAt","childstate_getStorage","childstate_getStorageEntries","childstate_getStorageHash","childstate_getStorageSize","grandpa_proveFinality","grandpa_roundState","grandpa_subscribeJustifications","grandpa_unsubscribeJustifications","mmr_generateBatchProof","mmr_generateProof","offchain_localStorageGet","offchain_localStorageSet","payment_queryFeeDetails","payment_queryInfo","state_call","state_callAt","state_getChildReadProof","state_getKeys","state_getKeysPaged","state_getKeysPagedAt","state_getMetadata","state_getPairs","state_getReadProof","state_getRuntimeVersion","state_getStorage","state_getStorageAt","state_getStorageHash","state_getStorageHashAt","state_getStorageSize","state_getStorageSizeAt","state_queryStorage","state_queryStorageAt","state_subscribeRuntimeVersion","state_subscribeStorage","state_traceBlock","state_trieMigrationStatus","state_unsubscribeRuntimeVersion","state_unsubscribeStorage","subscribe_newHead","sync_state_genSyncSpec","system_accountNextIndex","system_addLogFilter","system_addReservedPeer","system_chain","system_chainType","system_dryRun","system_dryRunAt","system_health","system_localListenAddresses","system_localPeerId","system_name","system_nodeRoles","system_peers","system_properties","system_removeReservedPeer","system_reservedPeers","system_resetLogFilter","system_syncState","system_unstable_networkState","system_version","unsubscribe_newHead"],"version":1},"id":1}\n\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Note that this call will show even those RPC methods which are disabled by a safety flag like\n",(0,a.jsx)(n.code,{children:"--rpc-methods Safe"}),". This is\n",(0,a.jsx)(n.a,{href:"https://github.com/paritytech/substrate/issues/7024",children:"being worked on"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Add parameters in the call, for example get a block by its hash value:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'echo \'{"id":1,"jsonrpc":"2.0","method":"chain_getBlock","params":["0x7d4ef171d483d37aa2339877524f0731af98e367c38f8fa27f133193ed2b5615"]}\' | websocat -n1 -B 99999999 ws://127.0.0.1:9944\n\n{"jsonrpc":"2.0","result":{"block":{"header":{"parentHash":"0xb5e10293122a3c706dfcf5c0e89d5fb90929e7ee580c5167e439afa330fae2c7","number":"0xbb07fe","stateRoot":"0x872dfbb3516a6e3b9becf01bb2192e53a1d77ef6c37e426f03ebf64b33a68ede","extrinsicsRoot":"0xe131e6af57c503ca6c6a151b2e621d05f65ef7be07e24abc2444fa1eb67c444a","digest":{"logs":["0x0642414245b50103b9000000ebdf8810000000002621c85fe312c4b8b9db111b9311a2857e265a62c7bd5a9b08f3e0989e51ea619481408decdc83f0f1322b706b50904f692f3c2dd505e7633dc029ca38a3f40072e7378760cf44e83566ec92ee330042d916684e957399badba91ed342a3270d","0x0542414245010190e94b9f1af95ae7645f85dc3d49f4c73dcce31083c9e1f712523a9b132aff798f89e0e6146429a869dde4ee060e7630831890f15942d5889ac4dfa24150368a"]}},"extrinsics":["0x280403000bd61300888301","..."]},"justifications":null},"id":1}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Some return values may not appear meaningful at first glance. Polkadot uses\n",(0,a.jsx)(n.a,{href:"https://docs.substrate.io/reference/scale-codec/",children:"SCALE encoding"})," as a format that is suitable for\nresource-constrained execution environments. You will need to decode the information and use the\nchain ",(0,a.jsx)(n.a,{href:"https://docs.substrate.io/reference/command-line-tools/subxt/#metadata",children:"metadata"}),"\n(",(0,a.jsx)(n.code,{children:"state_getMetadata"}),") to obtain human-readable information."]}),"\n",(0,a.jsx)(n.h3,{id:"tracking-the-chain-head",children:"Tracking the Chain Head"}),"\n",(0,a.jsxs)(n.p,{children:["Use the RPC endpoint ",(0,a.jsx)(n.code,{children:"chain_subscribeFinalizedHeads"})," to subscribe to a stream of hashes of finalized\nheaders, or ",(0,a.jsx)(n.code,{children:"chain_FinalizedHeads"})," to fetch the latest hash of the finalized header. Use\n",(0,a.jsx)(n.code,{children:"chain_getBlock"})," to get the block associated with a given hash. ",(0,a.jsx)(n.code,{children:"chain_getBlock"})," only accepts block\nhashes, so if you need to query intermediate blocks, use ",(0,a.jsx)(n.code,{children:"chain_getBlockHash"})," to get the block hash\nfrom a block number."]}),"\n",(0,a.jsx)(n.h2,{id:"substrate-api-sidecar",children:"Substrate API Sidecar"}),"\n",(0,a.jsx)(n.p,{children:"Parity maintains an RPC client, written in TypeScript, that exposes a limited set of endpoints. It\nhandles the metadata and codec logic so that you are always dealing with decoded information. It\nalso aggregates information that an infrastructure business may need for accounting and auditing,\ne.g. transaction fees."}),"\n",(0,a.jsxs)(n.p,{children:["The sidecar can fetch blocks, get the balance of an address atomically (i.e., with a corresponding\nblock number), get the chain's metadata, get a transaction fee prediction, calculate outstanding\nstaking rewards for an address, submit transactions to a node's transaction queue, and\n",(0,a.jsx)(n.a,{href:"https://paritytech.github.io/substrate-api-sidecar/dist/",children:"much more"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["The client runs on an HTTP host. The following examples use python3, but you can query any way you\nprefer at ",(0,a.jsx)(n.code,{children:"http://HOST:PORT/"}),". The default is ",(0,a.jsx)(n.code,{children:"http://127.0.0.1:8080"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"fetching-a-block",children:"Fetching a Block"}),"\n",(0,a.jsxs)(n.p,{children:["Fetch a block using the ",(0,a.jsx)(n.code,{children:"block/number"})," endpoint. To get the chain tip, omit the block number."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import requests\nimport json\n\nurl = 'http://127.0.0.1:8080/blocks/7409038'\nresponse = requests.get(url)\nif response.ok:\n\tblock_info = json.loads(response.text)\n\tprint(block_info)\n"})}),"\n",(0,a.jsx)(n.p,{children:"This returns a fully decoded block."}),"\n",(0,a.jsxs)(n.p,{children:["In the ",(0,a.jsx)(n.code,{children:"balances.transfer"})," extrinsic, the ",(0,a.jsx)(n.code,{children:"partialFee"}),' item is the transaction fee. It is called\n"partial fee" because the ',(0,a.jsx)(n.a,{href:"/docs/build-protocol-info#fees",children:"total fee"})," would include the ",(0,a.jsx)(n.code,{children:"tip"})," field.\nNotice that some extrinsics do not have a signature. These are\n",(0,a.jsx)(n.a,{href:"/docs/build-protocol-info#extrinsics",children:"inherents"}),"."]}),"\n",(0,a.jsx)(n.admonition,{title:"Tracking transaction fees",type:"info",children:(0,a.jsxs)(n.p,{children:["When tracking transaction fees, the ",(0,a.jsx)(n.code,{children:"extrinsics.paysFee"})," value is not sufficient for determining if\nthe extrinsic had a fee. This field only means that it would require a fee if submitted as a\ntransaction. In order to charge a fee, a transaction also needs to be signed. So in the following\nexample, the ",(0,a.jsx)(n.code,{children:"timestamp.set"})," extrinsic does not pay a fee because it is an ",(0,a.jsx)(n.em,{children:"inherent,"})," put in the\nblock by the block author."]})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'{\n   "number":"7409038",\n   "hash":"0x0e9610f3c89fac046ef83aa625ad414d5403031faa026b7ab2a918184e389968",\n   "parentHash":"0xba308541eb207bc639f36d392706309a031c21622f883fb07411060389c5ffdd",\n   "stateRoot":"0x4426383b64a944ad7222a4019aefd558c749da0c6920cfcdfd587741d54abbe2",\n   "extrinsicsRoot":"0x74749e5f5aeb610bc23fd6d8d79fd8bbf5e4b6053f70ba94ea6b3cc271df4b3a",\n   "authorId":"Fvvz6Ej1D5ZR5ZTK1vE1dCjBvkbxE1VncptEtmFaecXe4PF",\n   "logs":[\n      {\n         "type":"PreRuntime",\n         "index":"6",\n         "value":[\n            "BABE",\n            "0x023a0200009c7d191000000000"\n         ]\n      },\n      {\n         "type":"Seal",\n         "index":"5",\n         "value":[\n            "BABE",\n            "0x2296a50fa4fea3a46a95ad5b1f09de76d22c6ed3dc6755718c976e2d14c63e4dd3c6257813d9bdc03bb180b1e20393f1558ae1204982e5c7570df393e11f908b"\n         ]\n      }\n   ],\n   "onInitialize":{\n      "events":[\n\n      ]\n   },\n   "extrinsics":[\n      {\n         "method":{\n            "pallet":"timestamp",\n            "method":"set"\n         },\n         "signature":null,\n         "nonce":null,\n         "args":{\n            "now":"1620636072000"\n         },\n         "tip":null,\n         "hash":"0x8b853f49b6543e4fcbc796ad3574ea5601d2869d80629e080e501da4cb7b74b4",\n         "info":{\n\n         },\n         "events":[\n            {\n               "method":{\n                  "pallet":"system",\n                  "method":"ExtrinsicSuccess"\n               },\n               "data":[\n                  {\n                     "weight":"185253000",\n                     "class":"Mandatory",\n                     "paysFee":"Yes"\n                  }\n               ]\n            }\n         ],\n         "success":true,\n         "paysFee":false\n      },\n      {\n         "method":{\n            "pallet":"balances",\n            "method":"transfer"\n         },\n         "signature":{\n            "signature":"0x94b63112648e8e692f0076fa1ccab3a04510c269d1392c1df2560503865e144e3afd578f1e37e98063b64b98a77a89a9cdc8ade579dcac0984e78d90646a052001",\n            "signer":{\n               "id":"Gr5sBB1EgdmQ7FG3Ud2BdECWQTMDXNgGPfdHMMtDsmT4Dj3"\n            }\n         },\n         "nonce":"12",\n         "args":{\n            "dest":{\n               "id":"J6ksma2jVeHRcRoYPZBkJRzRbckys7oSmgvjKLrVbj1U8bE"\n            },\n            "value":"100000000"\n         },\n         "tip":"0",\n         "hash":"0xfbc5e5de75d64abe5aa3ee9272a3112b3ce53710664f6f2b9416b2ffda8799c2",\n         "info":{\n            "weight":"201217000",\n            "class":"Normal",\n            "partialFee":"2583332634"\n         },\n         "events":[\n            {\n               "method":{\n                  "pallet":"balances",\n                  "method":"Transfer"\n               },\n               "data":[\n                  "Gr5sBB1EgdmQ7FG3Ud2BdECWQTMDXNgGPfdHMMtDsmT4Dj3",\n                  "J6ksma2jVeHRcRoYPZBkJRzRbckys7oSmgvjKLrVbj1U8bE",\n                  "100000000"\n               ]\n            },\n            {\n               "method":{\n                  "pallet":"balances",\n                  "method":"Deposit"\n               },\n               "data":[\n                  "Fvvz6Ej1D5ZR5ZTK1vE1dCjBvkbxE1VncptEtmFaecXe4PF",\n                  "2583332634"\n               ]\n            },\n            {\n               "method":{\n                  "pallet":"system",\n                  "method":"ExtrinsicSuccess"\n               },\n               "data":[\n                  {\n                     "weight":"201217000",\n                     "class":"Normal",\n                     "paysFee":"Yes"\n                  }\n               ]\n            }\n         ],\n         "success":true,\n         "paysFee":true\n      },\n      {\n         "method":{\n            "pallet":"utility",\n            "method":"batch"\n         },\n         "signature":{\n            "signature":"0x8aa2fc3f0cff52533745679523705720cff42d0e7258b9797feed193deb0ca73474726e148af0a0b096d44c07f20e5292819ec92279cffb2897e95cc337e638e",\n            "signer":{\n               "id":"F4gmSZGiM9pMYPsKW7xnGktDr4zRmN2jqy5Ze678y9YWR7F"\n            }\n         },\n         "nonce":"687",\n         "args":{\n            "calls":[\n               {\n                  "method":{\n                     "pallet":"staking",\n                     "method":"payoutStakers"\n                  },\n                  "args":{\n                     "validator_stash":"Cfish3zJiFnTvR9jscCap7imeA9ep3cH1wZfcZwAp2gdZHo",\n                     "era":"2229"\n                  }\n               },\n               {\n                  "method":{\n                     "pallet":"staking",\n                     "method":"payoutStakers"\n                  },\n                  "args":{\n                     "validator_stash":"Cfish3zJiFnTvR9jscCap7imeA9ep3cH1wZfcZwAp2gdZHo",\n                     "era":"2230"\n                  }\n               },\n               {\n                  "method":{\n                     "pallet":"staking",\n                     "method":"payoutStakers"\n                  },\n                  "args":{\n                     "validator_stash":"Cfish3zJiFnTvR9jscCap7imeA9ep3cH1wZfcZwAp2gdZHo",\n                     "era":"2231"\n                  }\n               },\n               {\n                  "method":{\n                     "pallet":"staking",\n                     "method":"payoutStakers"\n                  },\n                  "args":{\n                     "validator_stash":"DifishR4auphofhzxsy2aupgYo4NaUECH7qgt71CgiB2o6P",\n                     "era":"2231"\n                  }\n               },\n               {\n                  "method":{\n                     "pallet":"staking",\n                     "method":"payoutStakers"\n                  },\n                  "args":{\n                     "validator_stash":"J1fishfH94nFZLNScHgC2HorWpFD2xdPxd96wtTCHLvKxfa",\n                     "era":"2231"\n                  }\n               }\n            ]\n         },\n         "tip":"0",\n         "hash":"0x69171ec3f4e5e4dfd27f4d1c5b5dbc884932c5d9a078c84495bb7ab875c8785f",\n         "info":{\n            "weight":"629782467000",\n            "class":"Normal",\n            "partialFee":"5150837715"\n         },\n         "events":[\n            {\n               "method":{\n                  "pallet":"staking",\n                  "method":"Reward"\n               },\n               "data":[\n                  "Cfish3zJiFnTvR9jscCap7imeA9ep3cH1wZfcZwAp2gdZHo",\n                  "40730624074"\n               ]\n            },\n            {\n               "method":{\n                  "pallet":"staking",\n                  "method":"Reward"\n               },\n               "data":[\n                  "FhLcXuFkTwyc3o9K82VBahpain1YHWyGeNMDTTyeDJKfm5b",\n                  "4296071738"\n               ]\n            },\n            {\n               "method":{\n                  "pallet":"staking",\n                  "method":"Reward"\n               },\n               "data":[\n                  "F1NyXFUayqmVMdjNK45hcaTCE3JiqdU83sEGhQ3HQXn2Rpq",\n                  "1770904403"\n               ]\n            },\n\n            // ...\n\n            {\n               "method":{\n                  "pallet":"utility",\n                  "method":"BatchCompleted"\n               },\n               "data":[\n\n               ]\n            },\n            {\n               "method":{\n                  "pallet":"balances",\n                  "method":"Deposit"\n               },\n               "data":[\n                  "Fvvz6Ej1D5ZR5ZTK1vE1dCjBvkbxE1VncptEtmFaecXe4PF",\n                  "5150837715"\n               ]\n            },\n            {\n               "method":{\n                  "pallet":"system",\n                  "method":"ExtrinsicSuccess"\n               },\n               "data":[\n                  {\n                     "weight":"629782467000",\n                     "class":"Normal",\n                     "paysFee":"Yes"\n                  }\n               ]\n            }\n         ],\n         "success":true,\n         "paysFee":true\n      }\n   ],\n   "onFinalize":{\n      "events":[\n\n      ]\n   },\n   "finalized":true\n}\n'})}),"\n",(0,a.jsx)(n.admonition,{title:"The JS number type is a 53 bit precision float",type:"info",children:(0,a.jsxs)(n.p,{children:["There is no guarantee that the numerical values in the response will have a numerical type. Any\nnumbers larger than ",(0,a.jsx)(n.code,{children:"2**53-1"})," will have a string type."]})}),"\n",(0,a.jsx)(n.h3,{id:"submitting-a-transaction",children:"Submitting a Transaction"}),"\n",(0,a.jsxs)(n.p,{children:["Submit a serialized transaction using the ",(0,a.jsx)(n.code,{children:"transaction"})," endpoint with an HTTP POST request."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import requests\nimport json\n\nurl = 'http://127.0.0.1:8080/transaction/'\ntx_headers = {'Content-type' : 'application/json', 'Accept' : 'text/plain'}\nresponse = requests.post(\n\turl,\n\tdata='{\"tx\": \"0xed0...000\"}', # A serialized tx.\n\theaders=tx_headers\n)\ntx_response = json.loads(response.text)\n"})}),"\n",(0,a.jsx)(n.p,{children:"If successful, this endpoint returns a JSON with the transaction hash. In case of error, it will\nreturn an error report, e.g.:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'{\n    "error": "Failed to parse a tx" | "Failed to submit a tx",\n    "cause": "Upstream error description"\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var a=t(96540);const s={},i=a.createContext(s);function r(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);