"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1608],{17740:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var s=t(74848),o=t(28453);const r={id:"maintain-wss",title:"Secure the WebSocket",sidebar_label:"Secure the WebSocket",description:"Steps on setting up a secure socket for remote connections.",keywords:["web socket","remote","connection","secure websocket"],slug:"../maintain-wss"},a=void 0,i={id:"maintain/maintain-wss",title:"Secure the WebSocket",description:"Steps on setting up a secure socket for remote connections.",source:"@site/../docs/maintain/maintain-wss.md",sourceDirName:"maintain",slug:"/maintain-wss",permalink:"/docs/maintain-wss",draft:!1,unlisted:!1,editUrl:"https://github.com/w3f/polkadot-wiki/edit/master/docs/maintain/maintain-wss.md",tags:[],version:"current",lastUpdatedBy:"Stakeworld",lastUpdatedAt:1683623723e3,frontMatter:{id:"maintain-wss",title:"Secure the WebSocket",sidebar_label:"Secure the WebSocket",description:"Steps on setting up a secure socket for remote connections.",keywords:["web socket","remote","connection","secure websocket"],slug:"../maintain-wss"},sidebar:"docs",previous:{title:"Set up a RPC node",permalink:"/docs/maintain-rpc"},next:{title:"Networks",permalink:"/docs/maintain-networks"}},c={},l=[{value:"Secure a WS Port",id:"secure-a-ws-port",level:2},{value:"Obtaining an SSL Certificate",id:"obtaining-an-ssl-certificate",level:3},{value:"Installing a Proxy Server",id:"installing-a-proxy-server",level:2},{value:"Nginx",id:"nginx",level:3},{value:"Apache2",id:"apache2",level:3},{value:"Connecting to the Node",id:"connecting-to-the-node",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"secure-a-ws-port",children:"Secure a WS Port"}),"\n",(0,s.jsxs)(n.p,{children:["A non-secure ws port can be converted to a secure wss port by placing it behind an SSL-enabled\nproxy. This can be used to secure a ",(0,s.jsx)(n.a,{href:"/docs/maintain-bootnode",children:"bootnode"})," or secure a\n",(0,s.jsx)(n.a,{href:"/docs/maintain-rpc",children:"RPC server"}),". The SSL-enabled apache2/nginx/other proxy server redirects\nrequests to the internal ws and converts it to a secure (wss) connection. For this, you will need an\nSSL certificate for which you can use a service like letsencrypt or self-signing."]}),"\n",(0,s.jsx)(n.h3,{id:"obtaining-an-ssl-certificate",children:"Obtaining an SSL Certificate"}),"\n",(0,s.jsxs)(n.p,{children:["One easy way to get a free SSL certificate can be achieved by following the LetsEncrypt instructions\n(",(0,s.jsx)(n.a,{href:"https://certbot.eff.org/instructions?ws=nginx&os=ubuntufocal",children:"nginx"}),"/",(0,s.jsx)(n.a,{href:"https://certbot.eff.org/instructions?ws=apache&os=ubuntufocal",children:"apache"}),").\nThis will auto-generate an SSL certificate and include it in your configuration."]}),"\n",(0,s.jsx)(n.p,{children:"Alternatively, you can generate a self-signed certificate and rely on the raw IP address of your\nnode when connecting to it. This is not preferable since you will have to whitelist the certificate\nto access it from a browser."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/selfsigned.key -out /etc/ssl/certs/selfsigned.crt\nsudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048\n"})}),"\n",(0,s.jsx)(n.h2,{id:"installing-a-proxy-server",children:"Installing a Proxy Server"}),"\n",(0,s.jsxs)(n.p,{children:["There are a lot of different implementations of a WebSocket proxy, some of the more widely used are\n",(0,s.jsx)(n.a,{href:"https://www.nginx.com/",children:"nginx"})," and ",(0,s.jsx)(n.a,{href:"https://httpd.apache.org/",children:"apache2"}),", for which configuration\nexamples provided below."]}),"\n",(0,s.jsx)(n.h3,{id:"nginx",children:"Nginx"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"apt install nginx\n"})}),"\n",(0,s.jsx)(n.p,{children:"In an SSL-enabled virtual host add:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:'server {\n  (...)\n  location / {\n    proxy_buffers 16 4k;\n    proxy_buffer_size 2k;\n    proxy_pass http://localhost:9944;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection "Upgrade";\n    proxy_set_header Host $host;\n   }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Optionally some form of rate limiting can be introduced:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:'http {\n  limit_req_zone  "$http_x_forwarded_for" zone=zone:10m rate=2r/s;\n  (...)\n}\n\nlocation / {\n  limit_req zone=zone burst=5;\n  (...)\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"apache2",children:"Apache2"}),"\n",(0,s.jsxs)(n.p,{children:["You can run it in different modes such as prefork, worker, or event. In this example, we use\n",(0,s.jsx)(n.a,{href:"https://httpd.apache.org/docs/2.4/mod/event.html",children:"event"})," which works well on higher load\nenvironments but other modes are also useful given the requirements."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"apt install apache2\na2dismod mpm_prefork\na2enmod mpm_event proxy proxy_html proxy_http proxy_wstunnel rewrite ssl\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.a,{href:"https://httpd.apache.org/docs/2.4/mod/mod_proxy_wstunnel.html",children:"mod_proxy_wstunnel"})," provides\n",(0,s.jsx)(n.em,{children:"support for the tunneling of web socket connections to a backend websockets server. The connection\nis automatically upgraded to a WebSocket connection"}),". In an SSL-enabled virtualhost add:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-apacheconf",children:"(...)\nSSLProxyEngine on\nProxyRequests off\n\nProxyPass / ws://localhost:9944\nProxyPassReverse / ws://localhost:9944\n"})}),"\n",(0,s.jsx)(n.p,{children:"Older versions of mod_proxy_wstunnel do not upgrade the connection automatically and will need the\nfollowing config added:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-apacheconf",children:"RewriteEngine on\nRewriteCond %{HTTP:Upgrade} websocket [NC]\nRewriteRule /(.*) ws://localhost:9944/$1 [P,L]\nRewriteRule /(.*) http://localhost:9944/$1 [P,L]\n"})}),"\n",(0,s.jsx)(n.p,{children:"Optionally some form of rate limiting can be introduced:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"apt install libapache2-mod-qos\na2enmod qos\n"})}),"\n",(0,s.jsxs)(n.p,{children:["And edit ",(0,s.jsx)(n.code,{children:"/etc/apache2/mods-available/qos.conf"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"# allows max 50 connections from a single ip address:\nQS_SrvMaxConnPerIP                                 50\n"})}),"\n",(0,s.jsx)(n.h2,{id:"connecting-to-the-node",children:"Connecting to the Node"}),"\n",(0,s.jsxs)(n.p,{children:["Open ",(0,s.jsx)(n.a,{href:"https://polkadot.js.org/apps",children:"Polkadot-JS UI"}),' and click the logo in the top left to switch the\nnode. Activate the "Development" toggle and input your node\'s address - either the domain or the IP\naddress. Remember to prefix with ',(0,s.jsx)(n.code,{children:"wss://"})," and if you're using the 443 port, append ",(0,s.jsx)(n.code,{children:":443"}),", like so:\n",(0,s.jsx)(n.code,{children:"wss://example.com:443"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"A sync-in-progress chain connected to Polkadot-JS UI",src:t(61189).A+"",width:"2876",height:"1626"})}),"\n",(0,s.jsx)(n.p,{children:"Now you have a secure remote connect setup for your Substrate node."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},61189:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/maintain-wss-image-0fe72147f38d8b6766328dd834a517a6.png"},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var s=t(96540);const o={},r=s.createContext(o);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);