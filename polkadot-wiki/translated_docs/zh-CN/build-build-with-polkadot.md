---
id: build-build-with-polkadot
title: Polkadot 開發者入门指南
sidebar_label: Polkadot 開發者入门指南
---

_本文是对博文[《波卡开发入门需知》](https://medium.com/polkadot-network/everything-you-need-to-know-to-prepare-for-polkadot-32d08b929735)的维护版本。_

作为一个区块链协议，波卡希望达成两个目标：为所有接入的平行链提供**共享安全性**，并允许所有接入的链使用[XCMP](learn-crosschain)来实现**互操作**。随着 Parity 的 Substrate 和 Cumulus 这类[PDKs](build-pdk)的问世，开发和启动一条新链所需花费的时间已大大减少。以前开发一条新链需要几年，而现在可能只需要几周甚至几天。

这份指南将带你了解想要使用 Polkadot 创建你的愿景，你现在能做的事儿。我们将解释平行链和智能合约之间的区别（以及为什么其中一个可能比另一个更适合你的应用程序）。还将列出现在可用的资源和即将发布的资源，以便你可以开始创建应用程序，并为参与今年晚些时候的 Polkadot 主网发布做准备。

## 我们处于哪里？

- 主网：**Polkadot**
- Canary network: **Kusama**
- 当前主要测试网络：**Westend**(Polkadot 的克隆) 和**Rococo** (平行链)
- Substrate:**2.0.0**
- ink!: **3.0** ([文献](https://substrate.dev/docs/en/knowledgebase/smart-contracts))

## 你需要了解的内容：

波卡的主网已经上线。 主要的测试网有两个。 - **Wesend**, 其目标是 运行类似于当前的 波卡的主网。 **Roco**, 专门用于 测试平行链。 此外，还有一个叫做 [Kusama](https://kusama.network) 的价值承载网络，在 Polkadot 操作之前 会获得功能。

波卡[采用丰富的编程语言](learn-implementations)，支持从 Rust 到 JavaScript 等一系列语言。在 Substrate 框架下当前主要采用 Rust 进行编程。Substrate 是一套支持开发者便捷地开发完整区块链应用的框架。这套框架通过集成核心要素而得以实现，这些要素有网络协议、共识层、Wasm 编译器和运行模块(也称为模块) 等。Cumulus 是一种对 Substrate 的扩展版本，它允许使用 Substrate 开发的链与波卡连接成为平行链。Substrate 当前发布的标签版本是 2.0.0，这一版拥有稳定版 API。

波卡的原生功能不支持智能合约，但可以通过平行链实现智能合约。用 Substrate 开发的链能够通过使用 Wasm 合约中的[Contracts](https://github.com/paritytech/substrate/tree/master/frame/contracts)模块和 FRAME 中的[EVM](https://github.com/paritytech/substrate/tree/master/frame/evm)模块来实现智能合约的功能。contracts 模块能够允许任意用户或者根据具体规则在链上部署 Wasm 编译的合约。为了促进 Wasm 智能合约的开发，Parity 也在开发一种基于 Rust 用来专门编写智能合约的语言[ink!](https://github.com/paritytech/ink)。

波卡主网自 2020 年 5 月正式上线。现在开发工具已经出现且趋于稳定，那当下正是尝试用波卡开发你项目的大好时机。但别急！在你一头扎进写代码前，你应该仔细考虑你想开发的去中心化应用的类型，并且了解一些适用于波卡开发者的不同范式。

## 平行链，平行线程，智能合约的区别是什么？

波卡为你提供了多种不同的开发应用的方式：可以作为现有平行链上部署的智能合约，也可作为你自己的平行链或者平行线程来开发。以上 3 种开发方式都有各自的优缺点，阅读本章节会帮助你理解三者的区别。

平行链是一条独立的链条，它拥有自己的运行逻辑，并且能够从波卡中继链提供的共享安全性和跨链通信机制中收益。平行链具有更高的灵活性和可定制性，但同时也需要更高的成本来开发和维护。

和平行链类似，平行线程使得开发者对其应用掌握更偏底层逻辑的控制。两者的主要区别在于使用成本，因为使用平行线程比用平行链更经济。平行线程的使用成本较低是因为它仅在需要时才产生新的区块，而平行链则不同，它每产生一个新的区块都需要保证插入一个中继链的插槽。当开发平行线程时，你所使用的开发工具 (如 PDKs) 以及获得的好处和开发平行链是一样的，而不用担心高额的使用成本。

在波卡主网上，会有一条或多条充当智能合约平台的平行链。智能合约是一种仅存在一条平行链上，复杂度有限的可执行程序。因为它们仅存在某一条链上，它们可以流畅地和同一条链上的其它智能合约互操作。尽管如此，这些合约一直会受其从属的主链特征的限制。

如果你需要对自己的应用的设计和特点拥有更多掌控力，平行链将是更好的选择。记住一点，智能合约可以先当做试验场，时机成熟后可再将其转换为平行链。智能合约平台通常具备类似 IDEs 一样便捷的工具以促进快速的迭代。此外，还可以针对智能合约创建一个 MVP 来评估用户兴趣，进而再将其开发为平行链。

对于打算从 0 到 1 开发一套货币系统以及面面俱到的链的开发者，平行链将赋予他们更多的发挥空间。相较于智能合约平台所呈现的复杂逻辑，平行链显得更为简单且有效。另外，平行链在治理方式上也赋予了更多的灵活性，相较于现行的硬分叉模式，平行链可以实现争议性更少的完整升级。

平行链或平行线程具有以下特点：

- 定制费用架构(例如: 固定费用交易费或按字节)。
- 定制货币政策用作原生币币和本地经济。
- 财政库通过状态转变函数获取资助。
- 一个通过 DAO 管理的，分配你的链上财政资产的治理模式。

![build 1](assets/build-1.png)

对于因采用智能合约使得成本高昂而难以执行的复杂运行逻辑，平行链为它的构建提供了可能性。然而，与智能合约不同的是，平行链缺少一个完整的 gas 计量系统，且很容易陷入死循环 bug (在智能合约的设计中会避免) 中。这一弱点在 Substrate 所采用的的权重系统中得到了缓解，但这也给平行链的开发者正确执行基准增加了更多负担。

你也可以选择套用平行链、平行线程以及智能合约的组合。如果你的部分逻辑必需包含循环，你可以使用运行原生平行链来处理所有这些复杂逻辑，采用智能合约来调用迭代。如果你需要从预言机上导入链下数据，你可以将平行线程用作每 24 小时触发一次数据导入的预言机 (如果这些数据对波卡生态里的其他用户也有价值，那么这种机制就最有意义了) 。

你很可能已经意识到了你的应用更适用于其中的某一种方式 (或是几种的混合) ，如果你需要快速回顾来消化这些信息，你可以将这张对比图作为备忘：

![build 2](assets/build-2.png)

> **注意:** 此的图片不包括平行线程，但正如我们之前提到平行链所有优点同样适用于平行线程。但是它们部署和维护成本较*低*。因此如果他们在上面的图表上有一列，它会在平行链列的"易于部署"和"维护费用"的更改为 `+`。

根据你在构建应用时对智能合约或者是平行链的使用选择，本指南现在将划分为两部分。你可以随意地阅读这两个部分，也可只阅读适用于你的部分。

- [你想建立平行链或平行线程!](#so-you-want-to-build-a-parachain-or-parathread)
- [你想建立智能合约!](#so-you-want-to-build-a-smart-contract)

## 所以你想开发平行链或是平行线程……

现在你已经决定将开发平行链或者平行线程作为你新项目的正确方式，下面就是决定使用哪个框架了。用于开发平行链或平行线程的框架被称为平行链开发套件 (PDKs) 。现阶段，只有 Parity Technologies 开发的 Substrate 和 Cumulus 可控选择。

未来会有很多不同语言编写的 PDKs，就像波卡 HOST 有多种[实现](learn-implementations.md)一样。

> **立即行动:** 您是否想开发一套全新的平行链开发套件？ Web3 基金会这些团队提供资助，了解更多并且在[W3F 资助页面](https://grants.web3.foundation)申请。

### 开始使用 Substrate

Substrate 是用于开发波卡的底层框架。它是为区块链创新者所开发的工具包，提供了开发新链所需的模块。它包含了模块式的运行插件库，你可以用它来开发你的链条逻辑，也可以用它来编写你自己的组件或者共享到社区。

开始使用 Substrate 的最佳方式是先去探索一下[Substrate 基础知识](https://substrate.dev/docs/en/)，这是一个由 Parity Technologies 创建并维护的在线知识库。

我们推荐你在知识库那里多逛逛，直到你熟悉了常用的模式为止。一旦你有了扎实的理解，你就可以在提供的教程中挑战自己所学来获得进步。

### 如何设定你的平行链

当你用 Substrate 创建了你的链条的运行逻辑后，你就可以将它编译成 Wasm 的可执行文件。这个 Wasm 代码文件包含了你链条的所有状态转换函数，将项目作为平行链或者平行线程部署到波卡上时将用到这份文件。

波卡上的验证人将使用这些已提交的 Wasm 代码来验证你的链条或者线程的状态的转变，但做这一验证需要一些额外的基础设施。验证人需要设法保持对最新的状态转换的跟进，因为波卡上节点无需同时成为你的链上的节点。

这里正是检验节点发挥作用的地方。校验器是装载你平行链的容器，它承担着至关重要的功能，为你的链条生成新的候选区块，并将它们传给波卡上的验证人以便验证人将其装入中继链。

虽然 Substrate 内置了自己的网络层，但不幸的是它只支持独立的链条 (不连接中继链的链条)。不过 Substrate 的扩展版 Cumulus 内置了校验节点，允许基于 Substrate 逻辑的平行链或者平行线程与波卡兼容。

#### Cumulus

建立[Cumulus](build-cumulus)的目标是作为 Substrate 的扩展，使得任意的 Substrate 运行环境都能与波卡兼容。

它能处理任何一条需要接入波卡的平行链其上的网络兼容性。包括：

- 跨链的信息传递。
- 开箱即用的收集人节点
- 一套中继链的嵌入式的轻客户端。
- Polkadot 出块者兼容性。
- 将 Cumulus 集成到你的 Substrate 链上使得它能以最少修改的方式工作在波卡上，这大概和导入 crate 模块并添加一条命令行一样的轻松。

### 如何在 Polkadot 中部署平行链或平行线程。

#### 平行链

为了将你的平行链添加到波卡网络中，你需要持有平行链插槽。

平行链插槽通过公开拍卖发售，相关的发售规则请参考 wiki 百科中[平行链拍卖](learn-auction)的内容。

#### 平行线程

平行线程不需要平行链插槽，所以你无需参与蜡烛拍卖。但你可以付费在中继链上注册你的平行线程代码后，然后就能参加按区块进行的拍卖，以使得你的状态转换可以包含到中继链上。

更多关于平行线程如何按区块拍卖的信息，请详见[平行线程](learn-parathreads)这页的内容。

## 智能合约的创建

波卡的中继链本身不支持智能合约，但由于接入波卡的平行链能够支持任意的状态转换，因此这些平行链能够支持智能合约。当平行链接入后，智能合约开发者便可以使用这些选项。如今开发技术已趋于成熟，先在本地链条上启动开发随后将其部署到线上环境的方式成为可能。

Substrate 有两种方式来支持开箱即用的智能合约开发。一种方式是使用文章[《合约》](https://github.com/paritytech/substrate/tree/master/frame/contracts)中的框架库所提供的模板，第二种方法是使用 Substrate 的[《EVM 模块》](https://github.com/paritytech/substrate/tree/master/frame/evm)来部署 EVM 作为底层从 Solidity 或 Vyper 语言编译过来的字节码，并能够使用以太坊的技术栈。

对于以前写过智能合约的开发者而言，他们对于部署 EVM 的链更为熟练。然而合约模块针对 EVM 的设计做了一些显著的改善，它们是：

1. **Wasm**. 此合约模块将 WebAssembly 用作自己的编译目标，凡是经过 Wasm 编译的语言都可被用作便携智能合约。不过写智能合约最好是有一个专门的特定领域语言，为此 Parity 提供了[ink!](#ink)语言。

2. **租赁**. 合约必须支付租金或者足额的抵押来证明它存在于链上的正当性。当一份合约没有做上述维护时，可能会产生一种叫做*tombstone*的引用。在某些情况下，如果合约没有达到以上要求，它将会随存储一起被彻底删除。

3. **缓存**. 默认情况下合约将被缓存，这意味着合约只需被部署一次，之后你就可以任意地对其做实例化。这种方式有助于最小化链上的存储负载。除此以外，当合约不再被使用且*现存的抵押*耗尽时，代码会从存储中被清除(也叫注销)。

或许你可能想着手开始在本地搭建测试环境，开始编写你的智能合约。将一个 Substrate 节点搭配两组智能合约模块中的一组一起使用可以完成上述工作。在完成测试环境的开发后，你需要查阅例如[用于部署智能合约的 Edgeware ](https://contracts.edgewa.re/)这样的项目以将你的项目做上线。

### Edgeware

[Edgeware](https://edgewa.re)是一个附带智能合约模块的项目。Edgeware 是一个针对智能合约做的免许可平台，正被用于进行链上治理的实验。它是目前开发智能合约并部署其上线的开发者的最佳选项。

Edgeware 的目标是被用于在连接波卡时被视作平行链从而允许其对智能合约的操作。此时，智能合约能够通过[XCMP](learn-crosschain)实现与其它波卡生态系统部分的交互。

关于 Edgeware 的通用文档可以看[这里](https://docs.edgewa.re/)以及[如何使用 Edgeware 部署智能合约](https://contracts.edgewa.re/)。

## Moonbeam

[Moonbeam](https://moonbeam.network)是另一个被计划用于将平行链部署到波卡上并且支持智能合约的项目。因为 Moonbeam 用到了[Frontier](https://github.com/paritytech/frontier)，它是一个附带了现有以太坊工具的互操作层，将以很小的摩擦支持所有针对 EVM 环境编写的应用程序。

跟着这篇[文档](https://docs.moonbeam.network/)试着去部署一个合约到 Moonbeam 上吧。

### Ink

[ink!](https://github.com/paritytech/ink)是一种特定领域语言用于使用 Rust 语言编写智能合约并将其编译为 Wasm 代码。如 README 中所述，ink 目前尚处于实验阶段，所以勇敢的开发者们也许会体验一段颤栗又可行的开发之旅。一些项目使用 ink!做的开发呈现出相当复杂的程度，例如 Plasm 的[Plasma 合约](https://github.com/staketechnologies/Plasm)，所以开发者需要足够熟练才能开始创造有趣的项目。

对于感兴趣的开发者，可以通过研究这些写好的[案例](https://github.com/paritytech/ink/tree/master/examples)开始学习编写智能合约。这些案例可以作为编写逻辑更复杂的会被部署到智能合约平行链的指引。

ink! 已经为新的智能合约技术栈打下了很多基础，该技术是基于 Wasm 的虚拟机并且能与 Substrate 链兼容。

## 智能合约的部署

智能合约简单讲就是一段包含链上地址并且能被外部参与者调用的代码。事实上关键的部分在于，你需要提前将代码放到链上以便任何用户都能对它做执行。

在链上部署智能合约的方式与您将使用的特定平行链略有不同，但通常你会发送一个特殊交易，该交易将在账本上创建智能合约。你可能需要为初始化逻辑以及合约占用的存储空间支付相关费用。

## 为你的智能合约付费

每个平台都有不同的支付方式和维护智能合约状态的方式。

你可能会看到为智能合约付费的不同模式，包括：

- 与部署交易关联的交易费用
- 订阅方式，你可以定期支付到该平台作费用
- 您需要持有本机令牌阈值才能使用平台的访问令牌模型 (EOS 具有类似的) 租金存储。
- 免费试用或开发者促销
- 大多数智能合约平台使用某种形式的 gas 费来限制用户可以执行的操作数量。用户将需要预先支付 gas 费，不使用的 gas 费将被退还。

您将需要考虑智能合约的存储和复杂性，以确保 gas 费用的数量保持在合理范围内。无论您使用哪种智能合约平台，存储费用都可能会很昂贵，因此有必要尽可能多的在链外保存数据。您可以考虑使用[IPFS](https://ipfs.io/)或[STORJ](https://storj.io/)来保留数据并仅在链上提交内容地址。

### 现在还处于早期

波卡上的智能合约仍处于早期阶段，并且直到现在才有了稳定的开发。我们正在积极地生产内容以帮助开发人员的开发加速，并将使用最新资源维护 Wiki。您也应该及时跟进以下链接的内容：

- [Edgeware](https://edgewa.re).
- [Moonbeam](https://moonbeam.network)
- [ink!](https://github.com/paritytech/ink). (请注意 Wiki 选项卡上的内容。)
- [Substrate 合约模块](https://github.com/paritytech/substrate/tree/master/frame/contracts)

## 总结

本指南为您提供了一个心智模型，并展示了必要的资源来帮助您确定并开始以平行链或智能合约的形式构建项目。即使工具仍在日趋成熟，但尽早开发的优势将是您对项目的熟悉和超前，使您能够创新并创造出真正全新的东西。

如果您对 Polkadot 上的平行链或智能合约抱有有趣的想法，请随时进入[波卡饮水机](https://riot.im/app/#/room/#polkadot-watercooler:matrix.org)进行讨论。开发者或许更感兴趣加入[波卡开发者小酒馆](https://riot.im/app/#/room/#polkadotnoobs:matrix.org)或者[Substrate 技术交流群](https://area51.stackexchange.com/proposals/126136/substrate)提问讨论。与往常一样，请关注 [社区频道](community)以便及时跟进 Polkadot 的最新动态。

祝好运！
